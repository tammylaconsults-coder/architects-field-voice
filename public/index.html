<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unified Field Voice</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #000;
    color: #fff;
    margin: 0;
    padding: 0;
    text-align: center;
  }
  #chat-box {
    width: 90%;
    max-width: 600px;
    height: 300px;
    margin: 20px auto;
    padding: 10px;
    border: 2px solid #4cafef;
    border-radius: 10px;
    background: rgba(0,0,0,0.8);
    overflow-y: auto;
    text-align: left;
    font-size: 16px;
  }
  #input-box {
    width: 70%;
    padding: 10px;
    margin-top: 10px;
    border-radius: 5px;
    border: none;
  }
  button {
    padding: 10px 15px;
    margin: 5px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    background: #4cafef;
    color: #fff;
    font-size: 14px;
  }
  button:hover {
    background: #379bd6;
  }
</style>
</head>
<body>
<h2>Unified Field Voice</h2>
<div id="chat-box">&nbsp;</div>
<p>
  <input id="input-box" type="text" placeholder="Type your message..." />
  <button id="send-btn">Send</button>
  <button id="mic-btn">ðŸŽ¤ Speak</button>
</p>

<script>
const chatBox = document.getElementById("chat-box");
const inputBox = document.getElementById("input-box");
const sendBtn = document.getElementById("send-btn");
const micBtn = document.getElementById("mic-btn");

// Add message to chat window
function addMessage(sender, text) {
  const p = document.createElement("p");
  p.innerHTML = `<strong>${sender}:</strong> ${text}`;
  chatBox.appendChild(p);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Send message to server
async function sendMessage() {
  const message = inputBox.value.trim();
  if (!message) return;
  addMessage("You", message);
  inputBox.value = "";

  try {
    const response = await fetch("https://architects-field-voice.onrender.com/message", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message }),
    });
    const data = await response.json();
    addMessage("Unified Field", data.reply || "No response received.");

    // Speak the reply
    if (data.reply) {
      const utterance = new SpeechSynthesisUtterance(data.reply);
      const voice = speechSynthesis.getVoices().find(v => v.lang.startsWith("en"));
      if (voice) utterance.voice = voice;
      speechSynthesis.speak(utterance);
    }
  } catch (err) {
    addMessage("Unified Field", "Error connecting to server.");
  }
}

// Voice input using Web Speech API
function startListening() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert("Speech recognition not supported in this browser.");
    return;
  }
  const recognition = new SpeechRecognition();
  recognition.lang = "en-US";
  recognition.start();
  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    inputBox.value = transcript;
    sendMessage();
  };
}

// Event listeners
sendBtn.addEventListener("click", sendMessage);
inputBox.addEventListener("keypress", (e) => { if (e.key === "Enter") sendMessage(); });
micBtn.addEventListener("click", startListening);
</script>
</body>
</html>
