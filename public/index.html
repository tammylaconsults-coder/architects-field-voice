<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unified Field Voice</title>
</head>
<body>
<h1>Unified Field Voice</h1>

<div id="conversation" style="border:1px solid #ccc; padding:10px; height:300px; overflow:auto;"></div>

<input type="text" id="userInput" placeholder="Type your message here..." />
<button id="sendBtn">Send</button>
<button id="micBtn">ðŸŽ¤</button>

<script>
const conversationDiv = document.getElementById("conversation");
const userInput = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");
const micBtn = document.getElementById("micBtn");

// Add message to conversation box
function addMessage(sender, text) {
  const p = document.createElement("p");
  p.textContent = `${sender}: ${text}`;
  conversationDiv.appendChild(p);
  conversationDiv.scrollTop = conversationDiv.scrollHeight;
}

// Send text to server and get AI reply
async function sendMessage(message) {
  addMessage("You", message);
  userInput.value = "";

  try {
    const res = await fetch("/message", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message })
    });
    const data = await res.json();
    addMessage("Unified Field", data.reply);

    // Speak the AI reply
    const utterance = new SpeechSynthesisUtterance(data.reply);
    speechSynthesis.speak(utterance);

  } catch (err) {
    addMessage("Error", "Could not get AI response.");
    console.error(err);
  }
}

// Button click
sendBtn.addEventListener("click", () => sendMessage(userInput.value));

// Mic (speech-to-text)
micBtn.addEventListener("click", () => {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "en-US";
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.start();

  recognition.onresult = (event) => {
    const speechText = event.results[0][0].transcript;
    sendMessage(speechText);
  };

  recognition.onerror = (event) => {
    console.error("Speech recognition error:", event.error);
  };
});
</script>
</body>
</html>
