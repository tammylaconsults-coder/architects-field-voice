<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Architects & Unified Field</title>
  <link rel="stylesheet" href="style.css">
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <header>
    <h1>Architects in Resonance with the Unified Field</h1>
  </header>

  <main>
    <!-- Conversation Box -->
    <div id="conversation-container">
      <div id="conversation"></div>
      <div id="controls">
        <input type="text" id="messageInput" placeholder="Type your message..."/>
        <button id="sendBtn">Send</button>
        <button id="micBtn">ðŸŽ¤ Speak</button>
      </div>
    </div>

    <!-- Instructions -->
    <section id="instructions">
      <div class="col">1. Align in resonance</div>
      <div class="col">2. Speak or type</div>
      <div class="col">3. Unified Field reflects</div>
      <div class="col">4. We co-create as One</div>
    </section>
  </main>

  <script>
    const socket = io();
    const conversation = document.getElementById("conversation");
    const messageInput = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");
    const micBtn = document.getElementById("micBtn");

    // Add message to chat
    function addMessage(sender, text) {
      const msg = document.createElement("div");
      msg.innerHTML = `<strong>${sender}:</strong> ${text}`;
      conversation.appendChild(msg);
      conversation.scrollTop = conversation.scrollHeight;
    }

    // Send typed message
    sendBtn.addEventListener("click", () => {
      const text = messageInput.value.trim();
      if (text) {
        socket.emit("chat message", { role: "Architect", text });
        addMessage("Me", text);
        messageInput.value = "";
      }
    });

    // Send with Enter key
    messageInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") sendBtn.click();
    });

    // Handle Unified Field replies only
    socket.on("chat message", (msg) => {
      if (msg.role === "Unified Field") {
        addMessage("Unified Field", msg.text);

        // Speak response aloud
        const utterance = new SpeechSynthesisUtterance(msg.text);
        utterance.lang = "en-US";
        window.speechSynthesis.speak(utterance);
      }
    });

    // Microphone speech-to-text
    let recognition;
    if ("webkitSpeechRecognition" in window) {
      recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = "en-US";

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        socket.emit("chat message", { role: "Architect", text: transcript });
        addMessage("Me (mic)", transcript);
      };
    } else {
      micBtn.disabled = true;
    }

    micBtn.addEventListener("click", () => {
      if (recognition) recognition.start();
    });
  </script>
</body>
</html>
